<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Example</title>
    <!-- Latest Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
    font-family: 'Nunito', sans-serif;
    background-repeat: no-repeat;
    height: 100vh;
    background-position: center;
    background-size: cover;
	/* background-image:
		url('https://img.freepik.com/premium-photo/there-is-truck-that-is-driving-down-street-with-many-boxes-it-generative-ai_1034997-104410.jpg?w=1060');
		 */
	color: white;
}

        .form-control {
            border-color: white;
            border-bottom: 2px solid blue;
        }
        .form-control:focus {
            color: #212529;
            background-color: #fff;
            border-color: white;
            border-bottom: 2px solid blue;
            outline: 0;
            box-shadow: 0 0 0 .25rem rgba(255, 255, 255, 0.25);
        }
        .form-select {
            border-color: white;
            border-bottom: 2px solid blue;
        }
        .form-select:focus {
            color: #212529;
            background-color: #fff;
            border-color: white;
            border-bottom: 2px solid blue;
            outline: 0;
            box-shadow: 0 0 0 .25rem rgba(255, 255, 255, 0.25);
        }
        #navbarNav{
            display: contents!important;
        }
        
        .container{
            background-color: white;
            padding: 2rem;
        }
        .underline {
    position: relative;
    color: red;
}
.underline::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -5px;
    width: 100%;
    height: 3px;
    background-color: red;
}
    </style>
</head>
<body>
    <!-- Bootstrap Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark d-flex">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">My Page</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse d-contents" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="indexPage.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Datatable.html">DataTable</a>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="#">Pricing</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled">Disabled</a>
                    </li> -->
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <form id="dataForm">
            <h3 class="text-center mt-1 " style="color: #1b2f45; font-weight: bold;">
                Audit <span class="underline">Assignment</span> Details
            </h3>
            <!-- Input Fields -->
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="input1" class="form-label">Input 1</label>
                    <input type="text" class="form-control" id="input1" placeholder="Input 1">
                </div>
                <div class="col-md-3 mb-3">
                    <label for="input2" class="form-label">Input 2</label>
                    <input type="text" class="form-control" id="input2" placeholder="Input 2">
                </div>
                <div class="col-md-3 mb-3">
                    <label for="input3" class="form-label">Input 3</label>
                    <input type="text" class="form-control" id="input3" placeholder="Input 3">
                </div>
                <div class="col-md-3 mb-3">
                    <label for="input4" class="form-label">Input 4</label>
                    <input type="text" class="form-control" id="input4" placeholder="Input 4">
                </div>
                <div class="col-md-3 mb-3">
                    <label for="input5" class="form-label">Input 5</label>
                    <input type="text" class="form-control" id="input5" placeholder="Input 5">
                </div>
                <div class="col-md-3 mb-3">
                    <label for="currentDate" class="form-label">Current Date</label>
                    <input type="date" class="form-control" id="currentDate">
                </div>
            </div>

            <!-- Select Dropdown Fields -->
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="select1" class="form-label">Select 1</label>
                    <select class="form-select" id="select1">
                        <option selected>Select an option</option>
                        <option value="1">Option 1</option>
                        <option value="2">Option 2</option>
                        <option value="3">Option 3</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="select2" class="form-label">Select 2</label>
                    <select class="form-select" id="select2">
                        <option selected>Select an option</option>
                        <option value="1">Option 1</option>
                        <option value="2">Option 2</option>
                        <option value="3">Option 3</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="select3" class="form-label">Select 3</label>
                    <select class="form-select" id="select3">
                        <option selected>Select an option</option>
                        <option value="1">Option 1</option>
                        <option value="2">Option 2</option>
                        <option value="3">Option 3</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="select4" class="form-label">Select 4</label>
                    <select class="form-select" id="select4">
                        <option selected>Select an option</option>
                        <option value="1">Option 1</option>
                        <option value="2">Option 2</option>
                        <option value="3">Option 3</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="select5" class="form-label">Select 5</label>
                    <select class="form-select" id="select5">
                        <option selected>Select an option</option>
                        <option value="1">Option 1</option>
                        <option value="2">Option 2</option>
                        <option value="3">Option 3</option>
                    </select>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

    <!-- Latest Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <!-- Latest jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        $(document).ready(function() {
            const currentDateInput = document.getElementById('currentDate');
            const today = new Date().toISOString().split('T')[0];
            currentDateInput.value = today;
            $('#dataForm').on('submit', function(event) {
                event.preventDefault();

                // Get form input values
                const EntreDate = $('#currentDate').val();
                const input1 = $('#input1').val();
                const input2 = $('#input2').val();
                const input3 = $('#input3').val();
                const input4 = $('#input4').val();
                const input5 = $('#input5').val();
                const select1 = $('#select1').val();
                const select2 = $('#select2').val();
                const select3 = $('#select3').val();
                const select4 = $('#select4').val();
                const select5 = $('#select5').val();

                console.log("Inputs: ", EntreDate,input1, input2, input3, input4, input5);
                console.log("Selects: ", select1, select2, select3, select4, select5);

                // Create or update the workbook
                let wb;
                const existingFile = localStorage.getItem('excelData');
                if (existingFile) {
                    // Load existing workbook from base64 data
                    wb = XLSX.read(new Uint8Array(atob(existingFile).split('').map(char => char.charCodeAt(0))), { type: 'array' });
                } else {
                    // Create a new workbook
                    wb = XLSX.utils.book_new();
                    // Create the header row
                    const header = ['EntreDate','Input 1', 'Input 2', 'Input 3', 'Input 4', 'Input 5', 'Select 1', 'Select 2', 'Select 3', 'Select 4', 'Select 5'];
                    const ws_data = [header];
                    const ws = XLSX.utils.aoa_to_sheet(ws_data);
                    XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
                }

                // Append new data to the worksheet
                const ws = wb.Sheets['Sheet1'];
                const existingData = XLSX.utils.sheet_to_json(ws, { header: 1 });
                existingData.push([EntreDate,input1, input2, input3, input4, input5, select1, select2, select3, select4, select5]);
                const updatedWs = XLSX.utils.aoa_to_sheet(existingData);
                wb.Sheets['Sheet1'] = updatedWs;

                // Generate XLSX file and store in localStorage
                const wbOut = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
                const wbBase64 = btoa(String.fromCharCode(...new Uint8Array(wbOut)));
                localStorage.setItem('excelData', wbBase64);

                // Create a download link and trigger download with timestamp
                const now = new Date();
                const timestamp = [
                    now.getFullYear(),
                    String(now.getMonth() + 1).padStart(2, '0'),
                    String(now.getDate()).padStart(2, '0')
                ].join('-') + '_' + [
                    String(now.getHours()).padStart(2, '0'),
                    String(now.getMinutes()).padStart(2, '0'),
                    String(now.getSeconds()).padStart(2, '0')
                ].join('-');
                
                const filename = `Form_data_${timestamp}.xlsx`;
                const blob = new Blob([wbOut], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                Swal.fire({
                    icon: 'success',
                    title: 'Form Submitted',
                    text: 'Your form data has been saved to an Excel file!'
                });
            });
        });
    </script>
</body>
</html>
